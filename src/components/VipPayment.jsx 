import React, { useState } from "react";
import UploadImage from "./UploadImage";
import { db, auth } from "../firebaseConfig";
import { collection, addDoc, serverTimestamp } from "firebase/firestore";

export default function VipPayment() {
  const [plan, setPlan] = useState("month1");
  const [proofUrl, setProofUrl] = useState("");
  const [msg, setMsg] = useState("");

  const prices = {
    month1: 300,
    months6: 1500,
    year12: 2500
  };

  const submitVip = async () => {
    if (!auth.currentUser) return setMsg("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.");

    try {
      await addDoc(collection(db, "vipRequests"), {
        uid: auth.currentUser.uid,
        plan,
        price: prices[plan],
        proofUrl,
        status: "pending",
        createdAt: serverTimestamp()
      });

      setMsg("âœ” ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ VIP ÙˆØ³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ Ù‚Ø±ÙŠØ¨Ø§Ù‹");
    } catch (err) {
      console.error(err);
      setMsg("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„");
    }
  };

  return (
    <div style={{ padding: 20 }}>
      <h2>âœ¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ù…ÙŠØ² VIP</h2>

      <label>Ø§Ø®ØªØ± Ø§Ù„Ø®Ø·Ø©:</label>
      <select
        value={plan}
        onChange={(e) => setPlan(e.target.value)}
        style={{ display: "block", marginTop: 10 }}
      >
        <option value="month1">1 Ø´Ù‡Ø± â€” 300 Ø¯Ø¬</option>
        <option value="months6">6 Ø£Ø´Ù‡Ø± â€” 1500 Ø¯Ø¬</option>
        <option value="year12">12 Ø´Ù‡Ø± â€” 2500 Ø¯Ø¬</option>
      </select>

      <h3 style={{ marginTop: 20 }}>ğŸ“¤ Ø±ÙØ¹ ÙˆØµÙ„ Ø§Ù„Ø¯ÙØ¹:</h3>
      <UploadImage onUploaded={setProofUrl} />

      <button
        onClick={submitVip}
        style={{ marginTop: 20, padding: "10px 20px" }}
      >
        Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
      </button>

      {msg && <p style={{ marginTop: 15 }}>{msg}</p>}
    </div>
  );
}